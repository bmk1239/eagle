name: Israel EPG Builder

on:
  schedule:
    - cron: '0 4 * * *'
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential git \
            libxml-simple-perl libdatetime-format-strptime-perl \
            libwww-perl libhtml-parser-perl libterm-readkey-perl \
            libfile-slurp-perl cpanminus

      - name: Clone and Build XMLTV (tv_grab_il only)
        run: |
          git clone https://github.com/XMLTV/xmltv.git
          cd xmltv
          PERL_MM_USE_DEFAULT=1 PERL5LIB=. perl Makefile.PL --grab tv_grab_il
          make
          sudo make install

      - name: Generate EPG
        run: |
          mkdir -p epg
          tv_grab_il --output epg/epg_il.xml --days 3 --quiet

      - name: Commit EPG
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "ðŸ‡®ðŸ‡± Daily Israeli EPG"
          file_pattern: epg/epg_il.xml
